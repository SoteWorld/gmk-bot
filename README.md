# Обзор

Telegram Mini App предоставляет богатый интерактивный интерфейс, который работает как веб-приложение прямо внутри Telegram. Это позволяет создать удобный пользовательский опыт для:

Поиска ближайшего магазина: Пользователи могут отправить свою геолокацию и получить список ближайших магазинов на интерактивной карте.
Построения маршрута: Генерация эффективного маршрута до выбранного магазина.
Просмотра новых продуктов: Получение актуальной информации о новых поступлениях в магазинах сети.

Данные о магазинах и новых продуктах собираются с веб-сайта сети магазинов с помощью парсинга и кэшируются в Redis для быстрого доступа.
# Архитектура проекта

Проект разделен на несколько взаимосвязанных слоев.

**Python (бэкенд)**

- `models` – pydantic модели `Store` и `Product`.
- `parsers` – асинхронные парсеры `StoreParser` и `ProductParser`.
- `repositories` – работа с Redis:
  - `BaseRedisRepository` – низкоуровневый доступ к Redis.
  - `StoreRedisRepository` и `ProductRedisRepository` – CRUD операции для моделей.
  - `RedisRepository` – объединяющий репозиторий.
- `services` – загрузка данных и вспомогательные функции:
  - `DataLoader` – сервис, который запускает парсеры и сохраняет результаты в Redis.
  - `DataProvider` – отдаёт данные из Redis и обновляет их при необходимости.
- `routes` – FastAPI роутеры для HTTP‑API (webhook, продукты, магазины).
```
[parsers] -> DataLoader -> RedisRepository -> Redis
```

Фронтенд представляет собой Telegram Mini App и взаимодействует с API бэкенда.

# Функционал
Бэкенд (Python)

- API для магазинов: Предоставляет данные о всех магазинах и позволяет найти ближайшие магазины по координатам пользователя.
- API для новых продуктов: Предоставляет информацию о новых продуктах.
  - `GET /products/all` — список всех продуктов.
  - `GET /products/categories` — список всех категорий продуктов.
  - `GET /products/category/{category}` — список всех продуктов указанной категории.
  - `GET /stores/nearby` — магазины, отсортированные по расстоянию до пользователя; принимает параметры `lat`, `lon` и `limit`.
- Телеграм-бот позволяет выбрать категорию и просмотреть товары только из неё.- Парсинг данных: Автоматическое извлечение данных о магазинах и новых продуктах с указанного веб-сайта сети.
- Кэширование данных: Использование Redis для быстрого доступа к спарсенным данным, снижения нагрузки на исходный сайт и улучшения отзывчивости приложения.
- Геокодирование: Расчет расстояний между точками и генерация ссылок на картографические сервисы для построения маршрутов.

Фронтенд (Web - Telegram Mini App)

- Интерактивный UI: Современный, отзывчивый интерфейс, разработанный на HTML, CSS и JavaScript.
- Отображение карты: Встроенная интерактивная карта для визуализации местоположения магазинов и пользователя.
- Поиск и фильтрация: Возможность поиска магазинов по названию/адресу и фильтрации новых продуктов по категориям.
- Информация о магазинах: Подробная информация о каждом магазине (адрес, телефон, часы работы).
- Детали новых продуктов: Отображение названий, описаний, цен и изображений новых продуктов.

# Технологии

- Бэкенд:
    - Python 3.10+
    - aiogram: Для взаимодействия с Telegram Bot API.
    - FastAPI : Для создания REST API и обслуживания Mini App.
    - uvicorn: ASGI-сервер для запуска FastAPI.
    - aiohttp: Для асинхронных HTTP-запросов (парсинг).
    - beautifulsoup4 / lxml: Для парсинга HTML.
    - pydantic: Для валидации данных и сериализации моделей (Store, Product).
    - redis[async]: Асинхронный клиент для Redis (кэширование).
    - geopy: Для географических расчетов.
    - python-dotenv: Для управления переменными окружения.
- Фронтенд:
    - HTML5, CSS3, JavaScript
    - Vue для более сложного UI.
    - Leaflet.js (или другие картографические библиотеки): Для интерактивных карт.
    - Telegram Web App API: Для взаимодействия Mini App с Telegram-ботом.
- Базы данных / Кэш:
    - Redis: In-memory база данных для кэширования спарсенных данных.
