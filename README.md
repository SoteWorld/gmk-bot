Обзор

Telegram Mini App предоставляет богатый интерактивный интерфейс, который работает как веб-приложение прямо внутри Telegram. Это позволяет создать удобный пользовательский опыт для:

    Поиска ближайшего магазина: Пользователи могут отправить свою геолокацию и получить список ближайших магазинов на интерактивной карте.
    Построения маршрута: Генерация эффективного маршрута до выбранного магазина.
    Просмотра новых продуктов: Получение актуальной информации о новых поступлениях в магазинах сети.

Данные о магазинах и новых продуктах собираются с веб-сайта сети магазинов с помощью парсинга и кэшируются в Redis для быстрого доступа.
Архитектура проекта

Проект разделен на две основные части: Бэкенд (Python) и Фронтенд (Web), взаимодействующие через API.

├── bot.py              # Основной файл Telegram-бота (aiogram)
├── config.py           # Конфигурация проекта (токены, URL-ы, настройки Redis)
├── handlers/           # Обработчики сообщений Telegram
│   └── mini_app.py     # Хэндлер для запуска Mini App
├── services/           # Бизнес-логика и взаимодействие с внешними сервисами
│   ├── store_api.py    # Парсинг данных с сайта, кэширование в Redis, работа с моделями Store и Product
│   └── geocoding.py    # Расчет расстояний, генерация маршрутов
├── models/             # Pydantic-модели данных
│   ├── store.py        # Модели Store (магазин) и Product (новый продукт)
├── keyboards/          # Клавиатуры Telegram (inline-кнопка для Mini App)
│   └── inline.py
├── web_app/            # Фронтенд Telegram Mini App (статические файлы)
│   ├── static/         # CSS, JS, изображения
│   │   ├── css/
│   │   ├── js/
│   │   └── images/
│   └── templates/      # HTML-файлы
│       └── index.html  # Основной HTML-файл Mini App
├── main.py             # Точка входа веб-сервера (FastAPI/Flask) для обслуживания API Mini App
└── utils/              # Вспомогательные утилиты

Функционал
Бэкенд (Python)

    API для магазинов: Предоставляет данные о всех магазинах и позволяет найти ближайшие магазины по координатам пользователя.
    API для новых продуктов: Предоставляет информацию о новых продуктах.
    Парсинг данных: Автоматическое извлечение данных о магазинах и новых продуктах с указанного веб-сайта сети.
    Кэширование данных: Использование Redis для быстрого доступа к спарсенным данным, снижения нагрузки на исходный сайт и улучшения отзывчивости приложения.
    Геокодирование: Расчет расстояний между точками и генерация ссылок на картографические сервисы для построения маршрутов.

Фронтенд (Web - Telegram Mini App)

    Интерактивный UI: Современный, отзывчивый интерфейс, разработанный на HTML, CSS и JavaScript.
    Отображение карты: Встроенная интерактивная карта для визуализации местоположения магазинов и пользователя.
    Поиск и фильтрация: Возможность поиска магазинов по названию/адресу и фильтрации новых продуктов по категориям.
    Информация о магазинах: Подробная информация о каждом магазине (адрес, телефон, часы работы).
    Детали новых продуктов: Отображение названий, описаний, цен и изображений новых продуктов.

Технологии

    Бэкенд:
        Python 3.10+
        aiogram: Для взаимодействия с Telegram Bot API.
        FastAPI (или Flask): Для создания RESTful API и обслуживания Mini App.
        uvicorn: ASGI-сервер для запуска FastAPI.
        aiohttp: Для асинхронных HTTP-запросов (парсинг).
        beautifulsoup4 / lxml: Для парсинга HTML.
        pydantic: Для валидации данных и сериализации моделей (Store, Product).
        redis[async]: Асинхронный клиент для Redis (кэширование).
        geopy: Для географических расчетов.
        python-dotenv: Для управления переменными окружения.
    Фронтенд:
        HTML5, CSS3, JavaScript
        (Опционально) JavaScript-фреймворки (например, React, Vue, Svelte) для более сложного UI.
        Leaflet.js (или другие картографические библиотеки): Для интерактивных карт.
        Telegram Web App API: Для взаимодействия Mini App с Telegram-ботом.
    Базы данных / Кэш:
        Redis: In-memory база данных для кэширования спарсенных данных.

План разработки
1. Подготовка и инициализация (Дни 1-2)

    Настройка виртуального окружения и установка всех необходимых зависимостей.
    Настройка файла config.py с токенами, URL-ами и параметрами Redis.
    Определение Pydantic-моделей Store и Product в models/store.py, с соответствующими полями для магазинов и новых товаров.

2. Бэкенд (Python) - Разработка API (Дни 3-5)

    Разработка сервиса services/store_api.py, который будет:
        Выполнять асинхронный парсинг веб-сайта для получения данных о магазинах и новых продуктах.
        Сохранять эти данные в Redis с установленным TTL (Time To Live).
        Предоставлять функции для получения данных из Redis (с fallback'ом на парсинг).
    Разработка сервиса services/geocoding.py для географических расчетов.
    Создание веб-сервера main.py на FastAPI (или Flask) с API-эндпоинтами:
        /stores (GET): Получение списка всех магазинов.
        /stores/nearest (GET): Поиск ближайших магазинов по координатам.
        /products/new (GET): Получение списка новых продуктов.
        /route (GET): Генерация ссылки на маршрут.
    Настройка обслуживания статических файлов Mini App через веб-сервер.

3. Фронтенд (Web) - Разработка Mini App (Дни 6-8)

    Создание базовой структуры web_app/ с index.html, CSS и JS файлами.
    Реализация логики Mini App на JavaScript:
        Получение геолокации пользователя.
        Отправка запросов к бэкенд API для получения данных.
        Отображение интерактивной карты и списка магазинов.
        Отображение информации о новых продуктах.
        Реализация интерактивных элементов (выбор магазина, построение маршрута, просмотр деталей продукта).
        Использование Telegram Web App API для взаимодействия с ботом.

4. Интеграция с Telegram Bot (День 9)

    Настройка bot.py для инициализации бота и диспетчера.
    Создание хэндлера в handlers/mini_app.py, который при команде (например, /start) будет отправлять пользователю кнопку для открытия Mini App (WebAppInfo).
    Добавление соответствующей inline-кнопки в keyboards/inline.py.

5. Сборка, тестирование и развертывание (Дни 10+)

    Тщательное тестирование всех сценариев использования Mini App и взаимодействия между компонентами.
    Развертывание бэкенда, фронтенда и Telegram-бота на выбранном хостинге.
    Настройка системы мониторинга и логирования для отслеживания работы приложения.
